<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•èµ›è½¦æ¸¸æˆä¿®å¤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        button { margin: 5px; padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>ğŸï¸ èµ›è½¦æ¸¸æˆä¿®å¤æµ‹è¯•</h1>
    
    <div>
        <button onclick="runTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
    </div>
    
    <div id="results"></div>

    <script>
        let gameId = null;

        async function runTest() {
            clearResults();
            addResult('å¼€å§‹æµ‹è¯•...', 'info');
            
            try {
                // 1. åˆ›å»ºæ¸¸æˆ
                addResult('1. åˆ›å»ºæ¸¸æˆ...', 'info');
                const createResponse = await fetch('http://localhost:8080/api/racing/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        player_count: 2,
                        round_count: 1,
                        player_names: ["æµ‹è¯•ç©å®¶1", "æµ‹è¯•ç©å®¶2"]
                    })
                });
                const createData = await createResponse.json();
                gameId = createData.game_id;
                addResult(`âœ… æ¸¸æˆåˆ›å»ºæˆåŠŸ: ${gameId}`, 'success');

                // 2. å¼€å§‹æ¸¸æˆ
                addResult('2. å¼€å§‹æ¸¸æˆ...', 'info');
                const startResponse = await fetch(`http://localhost:8080/api/racing/start/${gameId}`, {
                    method: 'POST'
                });
                const startData = await startResponse.json();
                addResult('âœ… æ¸¸æˆå¼€å§‹æˆåŠŸ', 'success');

                // 3. è§¦å‘ç»¿ç¯
                addResult('3. è§¦å‘ç»¿ç¯...', 'info');
                const triggerResponse = await fetch(`http://localhost:8080/api/racing/trigger/${gameId}`, {
                    method: 'POST'
                });
                const triggerData = await triggerResponse.json();
                addResult('âœ… ç»¿ç¯è§¦å‘æˆåŠŸ', 'success');

                // 4. è®°å½•ç©å®¶1ååº”
                addResult('4. è®°å½•ç©å®¶1ååº”...', 'info');
                const react1Response = await fetch('http://localhost:8080/api/racing/react', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game_id: gameId,
                        player_id: 1,
                        reaction_time: 586
                    })
                });
                const react1Data = await react1Response.json();
                addResult(`âœ… ç©å®¶1ååº”è®°å½•: ${JSON.stringify(react1Data)}`, 'success');

                // 5. è®°å½•ç©å®¶2ååº”
                addResult('5. è®°å½•ç©å®¶2ååº”...', 'info');
                const react2Response = await fetch('http://localhost:8080/api/racing/react', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game_id: gameId,
                        player_id: 2,
                        reaction_time: 905
                    })
                });
                const react2Data = await react2Response.json();
                addResult(`âœ… ç©å®¶2ååº”è®°å½•: ${JSON.stringify(react2Data)}`, 'success');

                // 6. ç»“æŸå›åˆ
                addResult('6. ç»“æŸå›åˆ...', 'info');
                const finishResponse = await fetch(`http://localhost:8080/api/racing/finish/${gameId}`, {
                    method: 'POST'
                });
                const finishData = await finishResponse.json();
                
                // æ£€æŸ¥ç»“æœ
                const hasValidResults = finishData.player_results.some(p => p.rank !== null);
                if (hasValidResults) {
                    addResult(`ğŸ‰ å›åˆç»“æœæ­£å¸¸: ${JSON.stringify(finishData, null, 2)}`, 'success');
                } else {
                    addResult(`âŒ å›åˆç»“æœå¼‚å¸¸: ${JSON.stringify(finishData, null, 2)}`, 'error');
                }

            } catch (error) {
                addResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function addResult(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        setTimeout(runTest, 1000);
    </script>
</body>
</html>